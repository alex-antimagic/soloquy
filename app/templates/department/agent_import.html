{% extends "layouts/base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('department.index') }}">Departments</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('department.view', department_id=department.id) }}">{{ department.name }}</a></li>
                    <li class="breadcrumb-item active">Import Agent</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h2>
                        <i class="bi bi-upload"></i>
                        Import Agent
                    </h2>
                    <p class="text-muted">Import an agent configuration from a JSON file</p>
                </div>
                <div>
                    <a href="{{ url_for('department.view', department_id=department.id) }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Department
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Import Form Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-file-earmark-arrow-up me-2"></i>Upload Agent Configuration</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('department.import_agent', department_id=department.id) }}" enctype="multipart/form-data">
                        {{ csrf_token() }}

                        <div class="mb-4">
                            <label for="agent_file" class="form-label">Select JSON File</label>
                            <input type="file"
                                   class="form-control"
                                   id="agent_file"
                                   name="agent_file"
                                   accept=".json"
                                   required>
                            <small class="form-text text-muted">
                                Upload a .json file exported from another agent
                            </small>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>What happens when you import:</strong>
                            <ul class="mb-0 mt-2">
                                <li>A new agent will be created in this department</li>
                                <li>All configuration (name, prompt, model settings) will be imported</li>
                                <li>Integration settings will be imported but you'll need to authorize connections</li>
                                <li>The agent will be created as version 1</li>
                                <li>You can edit the configuration after import</li>
                            </ul>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('department.view', department_id=department.id) }}" class="btn btn-secondary">
                                <i class="bi bi-arrow-left me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-upload me-2"></i>Import Agent
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Example File Structure -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-code-square me-2"></i>Expected File Format</h6>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-2">Your JSON file should have this structure:</p>
                    <pre class="bg-dark p-3 rounded" style="font-size: 0.85rem;"><code>{
  "export_version": "1.0",
  "export_date": "2025-11-17T10:00:00",
  "agent": {
    "name": "Sales Assistant",
    "description": "AI assistant for sales department",
    "system_prompt": "You are a helpful sales assistant...",
    "model": "claude-sonnet-4-5-20251022",
    "temperature": 1.0,
    "max_tokens": 4096,
    "is_active": true,
    "enable_quickbooks": false,
    "enable_gmail": false,
    ...
  },
  "metadata": {
    "original_department": "Sales",
    "created_by": "John Doe"
  }
}</code></pre>
                    <p class="small text-muted mb-0">
                        <i class="bi bi-lightbulb"></i>
                        <strong>Tip:</strong> Export an existing agent to see the exact format
                    </p>
                </div>
            </div>
        </div>

        <!-- Help Sidebar -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-question-circle me-2"></i>Import Guide</h6>
                </div>
                <div class="card-body">
                    <h6>How to Import</h6>
                    <ol class="small">
                        <li>Get a JSON file from:
                            <ul>
                                <li>Exporting an existing agent</li>
                                <li>Downloading from agent marketplace (coming soon)</li>
                                <li>Creating one manually</li>
                            </ul>
                        </li>
                        <li>Select the file using the form</li>
                        <li>Click "Import Agent"</li>
                        <li>Review and edit the imported configuration</li>
                    </ol>

                    <h6 class="mt-3">Validation</h6>
                    <p class="small">The system will validate:</p>
                    <ul class="small">
                        <li>JSON format is correct</li>
                        <li>Required fields are present</li>
                        <li>Model selection is valid</li>
                        <li>Temperature is between 0-1</li>
                        <li>Max tokens is between 256-8192</li>
                    </ul>

                    <h6 class="mt-3">Security</h6>
                    <p class="small">For security reasons:</p>
                    <ul class="small">
                        <li>Imported agents are never set as primary</li>
                        <li>Integration settings must be reauthorized</li>
                        <li>Only owners and admins can import</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h6 class="card-subtitle mb-2 text-muted">Need an Agent?</h6>
                    <p class="small">Coming soon: Browse and import agents from the community marketplace</p>
                    <button class="btn btn-sm btn-outline-secondary" disabled>
                        <i class="bi bi-shop"></i> Browse Marketplace
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
