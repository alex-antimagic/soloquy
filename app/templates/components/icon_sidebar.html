<!-- Icon Sidebar (Simplified single-column) -->
<div class="icon-sidebar d-flex flex-column">
    <!-- Workspace Header -->
    {% if current_tenant %}
    <div class="workspace-header">
        <div class="workspace-name" title="{{ current_tenant.name }}">
            {{ current_tenant.name }}
        </div>

        <!-- Workspace Switcher Dropdown -->
        <div class="dropdown">
            <button type="button"
                    class="icon-sidebar-item workspace-switch-btn"
                    data-bs-toggle="dropdown"
                    aria-expanded="false">
                <i class="bi bi-buildings"></i>
                <span class="icon-label">Switch</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-dark">
                {% for tenant in current_user.get_tenants() %}
                    <li>
                        <a class="dropdown-item {% if tenant.id == current_tenant.id %}active{% endif %}"
                           href="{{ url_for('tenant.switch_tenant', tenant_id=tenant.id) }}">
                            {{ tenant.name }}
                        </a>
                    </li>
                {% endfor %}
                <li><hr class="dropdown-divider"></li>
                {% if current_user.can_create_workspace() %}
                <li><a class="dropdown-item" href="{{ url_for('tenant.wizard') }}">
                    <i class="bi bi-plus-circle"></i> Create Workspace
                </a></li>
                {% else %}
                <li><a class="dropdown-item text-muted" href="{{ url_for('tenant.upgrade') }}">
                    <i class="bi bi-lock"></i> Create Workspace
                    <small class="d-block">Upgrade to Pro</small>
                </a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Navigation Icons -->
    <div class="icon-sidebar-items flex-grow-1">
        <!-- Home -->
        <a href="{{ url_for('tenant.home') }}"
           class="icon-sidebar-item {% if request.endpoint == 'tenant.home' %}active{% endif %}">
            <i class="bi bi-house-door"></i>
            <span class="icon-label">Home</span>
        </a>

        <!-- AI Agents -->
        <a href="{{ url_for('tenant.agents') }}"
           class="icon-sidebar-item {% if request.endpoint == 'tenant.agents' %}active{% endif %}">
            <i class="bi bi-robot"></i>
            <span class="icon-label">Agents</span>
        </a>

        <!-- Marketplace -->
        <a href="{{ url_for('marketplace.index') }}"
           class="icon-sidebar-item {% if 'marketplace' in request.endpoint %}active{% endif %}">
            <i class="bi bi-shop"></i>
            <span class="icon-label">Marketplace</span>
        </a>

        <div class="icon-sidebar-divider"></div>

        <!-- Tasks/Projects -->
        {% if 'projects' in enabled_applets or 'tasks' in enabled_applets %}
        <a href="{{ url_for('projects.index') }}"
           class="icon-sidebar-item {% if 'projects' in request.endpoint %}active{% endif %}"
           data-view="projects">
            <i class="bi bi-kanban"></i>
            <span class="icon-label">Tasks</span>
        </a>
        {% endif %}

        <!-- CRM -->
        {% if 'crm' in enabled_applets %}
        <a href="{{ url_for('crm.index') }}"
           class="icon-sidebar-item {% if 'crm' in request.endpoint %}active{% endif %}">
            <i class="bi bi-people"></i>
            <span class="icon-label">CRM</span>
        </a>
        {% endif %}

        <!-- Support -->
        {% if 'support' in enabled_applets %}
        <a href="{{ url_for('support.index') }}"
           class="icon-sidebar-item {% if 'support' in request.endpoint %}active{% endif %}"
           data-view="support">
            <i class="bi bi-headset"></i>
            <span class="icon-label">Support</span>
        </a>
        {% endif %}

        <!-- Website Builder -->
        {% if 'website' in enabled_applets %}
        <a href="{{ url_for('website.dashboard') }}"
           class="icon-sidebar-item {% if 'website' in request.endpoint %}active{% endif %}"
           data-view="website">
            <i class="bi bi-globe"></i>
            <span class="icon-label">Website</span>
        </a>
        {% endif %}

        <!-- Integrations -->
        {% if 'integrations' in enabled_applets %}
        <a href="{{ url_for('integrations.index') }}"
           class="icon-sidebar-item {% if 'integrations' in request.endpoint %}active{% endif %}"
           data-view="integrations">
            <i class="bi bi-plug"></i>
            <span class="icon-label">Apps</span>
        </a>
        {% endif %}
    </div>

    <!-- Bottom Icons -->
    <div class="icon-sidebar-bottom">
        <div class="icon-sidebar-divider"></div>

        <!-- System Admin (Superadmin only) -->
        {% if current_user.is_superadmin %}
        <a href="{{ url_for('admin.dashboard') }}"
           class="icon-sidebar-item {% if 'admin' in request.endpoint %}active{% endif %}"
           title="System Administration">
            <i class="bi bi-shield-lock text-danger"></i>
            <span class="icon-label">Admin</span>
        </a>
        {% endif %}

        <!-- Settings -->
        <a href="{{ url_for('tenant.settings') }}"
           class="icon-sidebar-item {% if request.endpoint == 'tenant.settings' %}active{% endif %}">
            <i class="bi bi-gear"></i>
            <span class="icon-label">Settings</span>
        </a>

        <!-- User Profile -->
        <div class="dropdown dropup">
            <button type="button"
                    class="icon-sidebar-item"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    title="{{ current_user.full_name }}">
                <div class="user-avatar-icon">
                    {% if current_user.avatar_url %}
                        <img src="{{ current_user.avatar_url }}" alt="{{ current_user.full_name }}" class="avatar-img">
                    {% else %}
                        <div class="avatar-placeholder-icon">
                            {{ current_user.full_name[0].upper() }}
                        </div>
                    {% endif %}
                    <span class="avatar-status online"></span>
                </div>
            </button>
            <ul class="dropdown-menu dropdown-menu-dark">
                <li class="dropdown-header">
                    {{ current_user.full_name }}
                    {% if current_user.plan == 'pro' %}
                    <span class="badge bg-primary ms-2" style="font-size: 0.7rem;">PRO</span>
                    {% endif %}
                </li>
                {% if current_tenant %}
                <li><a class="dropdown-item" href="{{ url_for('tenant.settings') }}">
                    <i class="bi bi-building-gear"></i> Workspace Settings
                </a></li>
                <li><hr class="dropdown-divider"></li>
                {% endif %}
                <li><a class="dropdown-item" href="{{ url_for('tenant.account_settings') }}"><i class="bi bi-person-gear"></i> Account Settings</a></li>
                {% if current_user.plan == 'free' %}
                <li><a class="dropdown-item" href="{{ url_for('tenant.upgrade') }}"><i class="bi bi-rocket-takeoff"></i> Upgrade to Pro</a></li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li>
                    <form action="{{ url_for('auth.logout') }}" method="POST" style="margin: 0;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="dropdown-item" style="border: none; background: none; cursor: pointer; width: 100%; text-align: left; padding: 0.25rem 1rem;">
                            <i class="bi bi-box-arrow-right"></i> Sign Out
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</div>
